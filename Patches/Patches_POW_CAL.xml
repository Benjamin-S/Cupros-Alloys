<?xml version="1.0" encoding="utf-8" ?>
<Patch>

	<!-- If Powerless is installed, add the crucible back in, allowing powerless alloying -->
	<Operation Class="PatchOperationSequence">
		<success>Always</success>
		<Operations>
			<li Class="CuprosAlloys.PatchOperationFindMod">
				<modName>Powerless!</modName>
			</li>
			<li Class="PatchOperationInsert">
				<!-- Inserting code before an attribute places it as a separate def -->
				<xpath>/ThingDefs/ThingDef[@Name="CampTableBase"]</xpath>
				<Order>Prepend</Order>
				<value>
					<ThingDef ParentName="BuildingBase">
						<DefName>POW_Crucible</DefName>
						<label>crucible</label>
						<ThingClass>Building_WorkTable</ThingClass>
						<Description>A structure dating back to chalcolithic times used for melting metal and creating alloys.</Description>
						<graphicData>
							<texPath>Cupro/Object/Station/Crucible/Crucible</texPath>
							<graphicClass>Graphic_Multi</graphicClass>
							<shaderType>CutoutComplex</shaderType>
						</graphicData>
						<fillPercent>0.25</fillPercent>
						<stuffCategories>
							<li>Stony</li>
						</stuffCategories>
						<costStuffCount>60</costStuffCount>
						<costList>
							<POW_Charcoal>25</POW_Charcoal>
						</costList>
						<altitudeLayer>Building</altitudeLayer>
						<UseHitPoints>true</UseHitPoints>
						<destroyable>true</destroyable>
						<rotatable>true</rotatable>
						<statBases>
							<MaxHitPoints>2000</MaxHitPoints>
							<WorkToBuild>1500</WorkToBuild>
							<Flammability>0</Flammability>
							<Cleanliness>-4</Cleanliness>
							<Mass>20</Mass>
						</statBases>
						<Size>(1,1)</Size>
						<DesignationCategory>Production</DesignationCategory>
						<Passability>PassThroughOnly</Passability>
						<canOverlapZones>false</canOverlapZones>
						<pathCost>60</pathCost>
						<hasInteractionCell>True</hasInteractionCell>
						<interactionCellOffset>(0,0,1)</interactionCellOffset>
						<surfaceType>Item</surfaceType>
						<tickerType>Normal</tickerType>
						<comps>
							<li>
								<compClass>CompQuality</compClass>
							</li>
							<li Class="CompProperties_AffectedByFacilities">
								<linkableFacilities>
									<li>POW_Bellows</li>
								</linkableFacilities>
							</li>
							<li Class="CompProperties_Refuelable">
								<fuelConsumptionRate>64.0</fuelConsumptionRate>
								<fuelCapacity>40.0</fuelCapacity>
								<fuelFilter>
									<thingDefs>
										<li>POW_Charcoal</li>
									</thingDefs>
								</fuelFilter>
								<consumeFuelOnlyWhenUsed>true</consumeFuelOnlyWhenUsed>
							</li>
							<li Class="Powerless.CompProperties_Smoker">
								<smokeStyle>Single</smokeStyle>
								<frequencyMin>800</frequencyMin>
								<frequencyMax>1200</frequencyMax>
								<produceSmokeOnlyWhenUsed>true</produceSmokeOnlyWhenUsed>
								<size>0.5</size>
							</li>
						</comps>
						<inspectorTabs>
							<li>ITab_Bills</li>
						</inspectorTabs>
						<building>
							<spawnedConceptLearnOpportunity>BillsTab</spawnedConceptLearnOpportunity>
							<heatPerTickWhileWorking>1.0</heatPerTickWhileWorking>
						</building>
						<placeWorkers>
							<li>PlaceWorker_ShowFacilitiesConnections</li>
						</placeWorkers>
						<researchPrerequisites>
							<li>POW_Forge</li>
						</researchPrerequisites>
					</ThingDef>
				</value>
			</li>
		</Operations>
	</Operation>
	
	<!-- Multiple sequences, because they just don't get applied in a single one -->
	<Operation Class="PatchOperationSequence">
		<success>Always</success>
		<Operations>
			<li Class="CuprosAlloys.PatchOperationFindMod">
				<modName>Powerless!</modName>
			</li>
			<li Class="PatchOperationReplace">
				<xpath>/ResearchProjectDefs/ResearchProjectDef[defName="POW_Forge"]/description</xpath>
				<value>
					<description>Allows colonists to build a forge for turning raw metal ingredients into weapons. Also unlocks the crucible, which can melt metals to make alloys.</description>
				</value>
			</li>
		</Operations>
	</Operation>
	
	<Operation Class="PatchOperationSequence">
		<success>Always</success>
		<Operations>
			<li Class="CuprosAlloys.PatchOperationFindMod">
				<modName>Powerless!</modName>
			</li>
			<li Class="PatchOperationReplace">
				<xpath>/ResearchProjectDefs/ResearchProjectDef[defName="CAL_UtilityAlloys"]/prerequisites</xpath>
				<value>
					<prerequisites>
						<li>POW_Forge</li>
					</prerequisites>
				</value>
			</li>
		</Operations>
	</Operation>
	
	<Operation Class="PatchOperationSequence">
		<success>Always</success>
		<Operations>
			<li Class="CuprosAlloys.PatchOperationFindMod">
				<modName>Powerless!</modName>
			</li>
			<li Class="PatchOperationReplace">
				<xpath>/ResearchProjectDefs/ResearchProjectDef[defName="CAL_DecorativeAlloys"]/prerequisites</xpath>
				<value>
					<prerequisites>
						<li>POW_Forge</li>
					</prerequisites>
				</value>
			</li>
		</Operations>
	</Operation>
	
	<Operation Class="PatchOperationSequence">
		<success>Always</success>
		<Operations>
			<li Class="CuprosAlloys.PatchOperationFindMod">
				<modName>Powerless!</modName>
			</li>
			<li Class="PatchOperationAdd">
				<xpath>/RecipeDefs/RecipeDef[@Name="AlloyBase"]/recipeUsers</xpath>
				<value>
					<li>POW_Crucible</li>
				</value>
			</li>
		</Operations>
	</Operation>

</Patch>